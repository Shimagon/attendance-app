<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }

        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            border: none;
            color: white;
        }

        .btn-green {
            background: #5CB85C;
        }

        .btn-blue {
            background: #4A90E2;
        }

        .btn-orange {
            background: #F0AD4E;
        }

        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }

        .success {
            color: green;
        }

        .error {
            color: red;
        }
    </style>
</head>

<body>
    <h1>ğŸ§ª å‹¤æ€ ç®¡ç†ã‚¢ãƒ—ãƒª APIãƒ†ã‚¹ãƒˆ</h1>

    <div class="test-section">
        <h2>è¨­å®š</h2>
        <p><strong>Apps Script URL:</strong></p>
        <input type="text" id="apiUrl" style="width: 100%; padding: 8px;"
            value="https://script.google.com/macros/s/AKfycbzcQ7XriEVHqwTChmeu97cjB1BFOZMP0VyfZYbNdW0swX5IwIiVCujxYcCsLQQJ-fxuIw/exec">
    </div>

    <div class="test-section">
        <h2>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h2>
        <button class="btn-green" onclick="testClockIn()">å‡ºå‹¤ãƒ†ã‚¹ãƒˆ</button>
        <button class="btn-blue" onclick="testClockOut()">é€€å‹¤ãƒ†ã‚¹ãƒˆ</button>
        <button class="btn-orange" onclick="testTaskComplete()">èª²é¡Œå®Œäº†ãƒ†ã‚¹ãƒˆ</button>
    </div>

    <div class="test-section">
        <h2>çµæœ</h2>
        <div id="result"></div>
    </div>

    <script>
        function getApiUrl() {
            return document.getElementById('apiUrl').value;
        }

        function showResult(title, success, data) {
            const resultDiv = document.getElementById('result');
            const timestamp = new Date().toLocaleString('ja-JP');
            const statusClass = success ? 'success' : 'error';
            const statusText = success ? 'âœ… æˆåŠŸ' : 'âŒ ã‚¨ãƒ©ãƒ¼';

            resultDiv.innerHTML = `
                <h3 class="${statusClass}">${title} - ${statusText}</h3>
                <p><small>${timestamp}</small></p>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            ` + resultDiv.innerHTML;
        }

        async function testClockIn() {
            const payload = {
                action: 'clockIn',
                userId: 'user01',
                userName: 'ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼',
                date: new Date().toISOString().split('T')[0],
                clockInTime: new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' })
            };

            console.log('ğŸ“¤ é€ä¿¡ãƒ‡ãƒ¼ã‚¿:', payload);

            try {
                const response = await fetch(getApiUrl(), {
                    method: 'POST',
                    // Google Apps Scriptã¯OPTIONSãƒ¡ã‚½ãƒƒãƒ‰(ãƒ—ãƒªãƒ•ãƒ©ã‚¤ãƒˆ)ã«å¯¾å¿œã—ã¦ã„ãªã„ãŸã‚ã€
                    // application/jsonã§ã¯ãªãtext/plainã¨ã—ã¦é€ä¿¡ã™ã‚‹ã“ã¨ã§ãƒ—ãƒªãƒ•ãƒ©ã‚¤ãƒˆã‚’å›é¿ã—ã¾ã™ã€‚
                    // GASå´ã§ã¯ e.postData.contents ã§JSONæ–‡å­—åˆ—ã¨ã—ã¦å—ã‘å–ã‚Œã¾ã™ã€‚
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                console.log('ğŸ“¥ ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', result);
                showResult('å‡ºå‹¤ãƒ†ã‚¹ãƒˆ', result.success, { request: payload, response: result });
            } catch (error) {
                console.error('âŒ ã‚¨ãƒ©ãƒ¼:', error);
                showResult('å‡ºå‹¤ãƒ†ã‚¹ãƒˆ', false, { request: payload, error: error.message });
            }
        }

        async function testClockOut() {
            const now = new Date();
            const clockInTime = new Date(now.getTime() - 8 * 60 * 60 * 1000); // 8æ™‚é–“å‰

            const payload = {
                action: 'clockOut',
                userId: 'user01',
                userName: 'ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼',
                date: now.toISOString().split('T')[0],
                clockInTime: clockInTime.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }),
                clockOutTime: now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }),
                workDuration: '8æ™‚é–“0åˆ†'
            };

            console.log('ğŸ“¤ é€ä¿¡ãƒ‡ãƒ¼ã‚¿:', payload);

            try {
                const response = await fetch(getApiUrl(), {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                console.log('ğŸ“¥ ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', result);
                showResult('é€€å‹¤ãƒ†ã‚¹ãƒˆ', result.success, { request: payload, response: result });
            } catch (error) {
                console.error('âŒ ã‚¨ãƒ©ãƒ¼:', error);
                showResult('é€€å‹¤ãƒ†ã‚¹ãƒˆ', false, { request: payload, error: error.message });
            }
        }

        async function testTaskComplete() {
            const payload = {
                action: 'taskComplete',
                userId: 'user01',
                userName: 'ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼',
                completedAt: new Date().toLocaleString('ja-JP'),
                appUrl: window.location.href
            };

            console.log('ğŸ“¤ é€ä¿¡ãƒ‡ãƒ¼ã‚¿:', payload);

            try {
                const response = await fetch(getApiUrl(), {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                console.log('ğŸ“¥ ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', result);
                showResult('èª²é¡Œå®Œäº†ãƒ†ã‚¹ãƒˆ', result.success, { request: payload, response: result });
            } catch (error) {
                console.error('âŒ ã‚¨ãƒ©ãƒ¼:', error);
                showResult('èª²é¡Œå®Œäº†ãƒ†ã‚¹ãƒˆ', false, { request: payload, error: error.message });
            }
        }
    </script>
</body>

</html>